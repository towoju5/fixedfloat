!function(){let n=UI.func,e={section:void 0,fieldAddr:void 0,fieldTag:void 0,wrapTag:void 0,errorAddr:void 0,errorTag:void 0,timerKeyup:-1,resizeField:function(){var e=this;e.fieldAddr.style.height="0";let t=getComputedStyle(e.fieldAddr,null);var r=parseFloat(t.getPropertyValue("padding-top")),i=(parseFloat(t.getPropertyValue("padding-bottom")),parseFloat(t.getPropertyValue("border-top-width"))),d=(parseFloat(t.getPropertyValue("border-bottom-width")),parseFloat(t.getPropertyValue("font-size"))),a=n.hasClass(e.fieldAddr,"multi");if(d+2*r+5>=e.fieldAddr.scrollHeight){if(a)return n.remClass(e.fieldAddr,"multi"),void e.resizeField()}else if(!a)return n.addClass(e.fieldAddr,"multi"),void e.resizeField();e.fieldAddr.style.height=a?e.fieldAddr.scrollHeight+r+1+"px":e.fieldAddr.scrollHeight+(r-i)+"px"},checkNeedTag:function(){var e=this;let t=e.fieldAddr.value;(result=t.match(/^(bnb1)[0-9a-z]{38}$/))||(result=t.match(/^(cosmos)[0-9a-z]{39}$/))||(result=t.match(/^G[A-D]{1}[A-Z2-7]{54}$/))?(n.remClass(e.wrapTag,"hidden"),e.fieldTag.setAttribute("placeholder","MEMO"),e.fieldTag.setAttribute("data-tag","MEMO")):(result=t.match(/^r[1-9A-HJ-NP-Za-km-z]{25,34}$/))?(n.remClass(e.wrapTag,"hidden"),e.fieldTag.setAttribute("placeholder","Destination Tag"),e.fieldTag.setAttribute("data-tag","Destination Tag")):(n.addClass(e.wrapTag,"hidden"),e.fieldTag.setAttribute("data-tag",""),e.fieldTag.value="")},init:function(){var i=this;i.section=n.id("access_address_section"),i.fieldAddr=n.id("access_address"),i.fieldTag=n.id("access_tag"),i.wrapTag=n.id("access_tag_outer"),i.errorAddr=n.id("access_address_error"),i.errorTag=n.id("access_tag_error"),n.bind(i.fieldAddr,"focus",function(){n.remClass(this,"error"),n.remClass(i.fieldTag,"error")}),n.bind(i.fieldTag,"focus",function(){n.remClass(this,"error"),n.remClass(i.fieldAddr,"error")}),n.bind(i.fieldAddr,"blur",function(){n.remClass(this,"error"),n.remClass(i.fieldTag,"error"),clearTimeout(i.timerKeyup)}),n.bind(i.fieldTag,"blur",function(){n.remClass(this,"error"),n.remClass(i.fieldAddr,"error"),clearTimeout(i.timerKeyup)}),n.bind(i.fieldAddr,"input",function(){n.remClass(this,"error"),clearTimeout(i.timerKeyup),i.checkNeedTag(),i.resizeField()}),n.bind(i.fieldAddr,"input",function(){n.remClass(this,"error"),n.remClass(i.fieldAddr,"error"),clearTimeout(i.timerKeyup)}),n.on(i.section,"click",".scanqr",function(e){(e=e||event).preventDefault();let t=this.closest(".dinput").querySelector(".dinput-field");n.remClass(t,"error"),UI.qrscan({scan:function(e){e=e.match(/(?:\w+:)?(\w+)(?:\?.*)?/i);t.value=e[1],t==i.fieldAddr&&(i.checkNeedTag(),i.resizeField()),t.blur(),this.close()}})}),n.on(i.section,"click",".close",function(e){(e=e||event).preventDefault(),clearTimeout(i.timerKeyup);let t=this.closest(".dinput").querySelector(".dinput-field");t.value="",t.focus(),t==i.fieldAddr&&(i.checkNeedTag(),i.resizeField())}),UI.button("unlock_submit").click(function(t){var r={id:this.getAttribute("data-id"),addr:i.fieldAddr.value,tag:i.fieldTag.value,tagName:i.fieldTag.getAttribute("data-tag")};if(!r.addr)return t.error(),void n.addClass(i.fieldAddr,"error");APP.api("exchangeGetAccess",r).then(function(e){t.success(),location.href="/order/"+r.id}).catch(function(e){t.error(),302==e.code?(n.addClass(i.fieldTag,"error"),i.errorTag.innerHTML=e.msg):(n.addClass(i.fieldAddr,"error"),i.errorAddr.innerHTML=e.msg)})}),window.addEventListener("resize",function(){i.resizeField()})}};window.AccessInit=function(){e.init()}}(),function(){let n=UI.func;function a(r){for(let t=0;t<r.length;t++){var i=+r[t].getAttribute("timestamp");if(100<i){let e=moment(moment.unix(i).toDate()).local();i=e.fromNow()+" ("+e.format("lll")+")";r[t].innerHTML!=i&&(r[t].innerHTML=i,r[t].setAttribute("title",i))}}}function s(e){let t=moment(moment.unix(+e).toDate()).local();return t.format("L")+" "+t.format("LT")}let d={keyupWallet:-1,errorInterval:-1,wsTry:!1,wsReady:!1},o={id:"",timeLeft:0,from:{amount:"",address:"",confirm:null,tx:null,timeBlock:null},to:{amount:"",address:"",confirm:null,tx:null,timeBlock:null},back:{address:"",confirm:null,tx:null,timeBlock:null},status:"",refundonly:!1,emergency:{status:[],choice:"",repeat:"",tmpl:""},timeInterval:-1,timeout:-1,timeUpd:0,html:{action:null,time:null,time_parent:null,time_creation:null,time_tx:null,time_competed:null,head_info:null,details:null,details_more:null,emergency:null},init:function(e){var t=this;t.id=e.id,t.timeLeft=e.timeLeft,t.from=e.from,t.to=e.to,t.back=e.back,t.status=e.status,t.refundonly=e.refundonly,t.emergency=e.emergency,t.html={action:n.id("order_action"),time:n.id("order_time"),time_parent:n.id("order_time").parentNode.parentNode,time_creation:n.id("order_time_creation"),time_tx:n.id("order_time_tx"),time_competed:n.id("order_time_competed"),head_info:n.id("order_info"),head_inner:n.id("order_info_inner"),details:n.id("order_details"),details_more:n.id("order_details_more"),emergency:n.id("section_emergency")},a(t.html.details.getElementsByTagName("time")),a(t.html.details_more.getElementsByTagName("time")),t.html.time_creation.innerHTML=s(t.html.time_creation.getAttribute("timestamp")),t.html.time_tx.innerHTML=s(t.html.time_tx.getAttribute("timestamp")),t.html.time_competed.innerHTML=s(t.html.time_competed.getAttribute("timestamp")),0<t.timeLeft&&"NEW"==t.status&&(t.timeInterval=setInterval(function(){t.html.time.setAttribute("data-time",APP.formatTime(--t.timeLeft)),t.timeLeft<=0&&(clearInterval(t.timeInterval),n.addClass("timeline_steps","expired"),n.addClass(t.html.time_parent,"expired"))},1e3)),t.onResize(),setInterval(function(){a(t.html.details.getElementsByTagName("time")),a(t.html.details_more.getElementsByTagName("time"))},6e4),window.addEventListener("resize",function(){t.onResize()})},update:function(e){var t=this;let r={status:!1,txs:!1,confirm:!1,address:!1,amountFrom:!1,amountTo:!1,emergency:!1};t.status!=e.status&&(t.status=e.status,r.status=!0),e.emergency.status=Array.isArray(e.emergency.status)?e.emergency.status.join(","):e.emergency.status,t.emergency.status!=e.emergency.status&&(t.emergency.status=e.emergency.status,r.emergency=!0),t.emergency.choice!=e.emergency.choice&&(t.emergency.choice=e.emergency.choice,r.emergency=!0),t.emergency.repeat!=e.emergency.repeat&&(t.emergency.repeat=e.emergency.repeat,r.emergency=!0),t.from.tx!=e.from.tx.id&&(t.from.tx=e.from.tx.id,r.txs=!0),t.to.tx!=e.to.tx.id&&(t.to.tx=e.to.tx.id,r.txs=!0),t.back.tx!=e.back.tx.id&&(t.back.tx=e.back.tx.id,r.txs=!0),t.from.address!=e.from.address&&(t.from.address=e.from.address,r.address=!0),t.to.address!=e.to.address&&(t.to.address=e.to.address,r.address=!0),t.back.address!=e.back.address&&(t.back.address=e.back.address,r.address=!0),t.from.confirm!=e.from.tx.confirmations&&(n.id("order_from_tx_confirmations")&&(t.from.confirm=e.from.tx.confirmations,n.id("order_from_tx_confirmations").innerHTML=null!=t.from.confirm?t.from.confirm:""),r.confirm=!0),t.to.confirm!=e.to.tx.confirmations&&(n.id("order_to_tx_confirmations")&&(t.to.confirm=e.to.tx.confirmations,n.id("order_to_tx_confirmations").innerHTML=null!=t.to.confirm?t.to.confirm:""),r.confirm=!0),t.back.confirm!=e.back.tx.confirmations&&(n.id("order_back_tx_confirmations")&&(t.back.confirm=e.back.tx.confirmations,n.id("order_back_tx_confirmations").innerHTML=null!=t.back.confirm?t.back.confirm:""),r.confirm=!0),t.from.amount!=n.minCountToFixed(e.from.amount,6,10)&&(t.from.amount=n.minCountToFixed(e.from.amount,6,10),n.id("order_send_value").innerHTML=t.from.amount+" "+e.from.symbol+(e.from.subSymbol?"<sup>"+e.from.subSymbol+"</sup>":""),r.amountFrom=!0),t.to.amount!=n.minCountToFixed(e.to.amount,6,10)&&(t.to.amount=n.minCountToFixed(e.to.amount,6,10),n.id("order_receive_value").innerHTML=t.to.amount+" "+e.to.symbol+(e.to.subSymbol?"<sup>"+e.to.subSymbol+"</sup>":""),r.amountTo=!0),t.from.timeBlock!=e.from.tx.timeBlock&&(t.from.timeBlock=e.from.tx.timeBlock,t.from.timeBlock&&n.id("order_from_tx_timeblock")&&n.id("order_from_tx_timeblock").setAttribute("timestamp",t.from.timeBlock)),t.to.timeBlock!=e.to.tx.timeBlock&&(t.to.timeBlock=e.to.tx.timeBlock,t.to.timeBlock&&n.id("order_to_tx_timeblock")&&n.id("order_to_tx_timeblock").setAttribute("timestamp",t.to.timeBlock)),t.back.timeBlock!=e.back.tx.timeBlock&&(t.back.timeBlock=e.back.tx.timeBlock,t.back.timeBlock&&n.id("order_back_tx_timeblock")&&n.id("order_back_tx_timeblock").setAttribute("timestamp",t.back.timeBlock));var i=0<=e.emergency.status.indexOf("MORE")&&0<=e.emergency.status.indexOf("LIMIT");t.refundonly="REFUND"==e.emergency.choice&&!i;let d=n.hasClass(t.html.time_tx.parentNode.parentNode,"none");"EXPIRED"!=t.status&&e.from.tx.timeReg?d&&(t.html.time_tx.setAttribute("timestamp",e.from.tx.timeReg),t.html.time_tx.innerHTML=s(e.from.tx.timeReg),n.remClass(t.html.time_tx.parentNode.parentNode,"none")):d||n.addClass(t.html.time_tx.parentNode.parentNode,"none"),d=n.hasClass(t.html.time_competed.parentNode.parentNode,"none"),(e.to.tx.id||e.back.tx.id)&&e.time.finish&&!t.refundonly?d&&(t.html.time_competed.setAttribute("timestamp",e.time.finish),t.html.time_competed.innerHTML=s(e.time.finish),n.remClass(t.html.time_competed.parentNode.parentNode,"none")):n.addClass(t.html.time_competed.parentNode.parentNode,"none"),n.togClass("timeline_pending","emergency-choice","EMERGENCY"==e.status),r.status||r.txs||r.amountFrom||r.emergency?t.getDetails():(a(t.html.details.getElementsByTagName("time")),a(t.html.details_more.getElementsByTagName("time")))},getDetails:function(t){var r=this;clearTimeout(r.timeout),APP.api("orderGetDetails",{id:r.id}).then(function(e){-1==r.timeout&&t||r.setStep(e.data.details,e.data.details_more,e.data.emergency),a(r.html.details.getElementsByTagName("time")),a(r.html.details_more.getElementsByTagName("time")),r.timeout=-1}).catch(function(e){a(r.html.details.getElementsByTagName("time")),a(r.html.details_more.getElementsByTagName("time")),r.timeout=setTimeout(function(){r.getDetails(!0)},5e3)})},setStep:function(e,t,r){var i=this;switch(n.remClass(document.querySelectorAll("#timeline_steps li:not(.emergency-choice)"),"active"),"REFUND"==i.status&&(i.status=i.refundonly&&i.back.tx||!i.refundonly&&i.to.tx?"DONE":"WITHDRAW"),"NEW"==i.status&&n.addClass("timeline_new","active"),"PENDING"!=i.status&&"EMERGENCY"!=i.status||n.addClass("timeline_pending","active"),"EXCHANGE"==i.status&&n.addClass("timeline_exchange","active"),i.refundonly&&n.addClass("timeline_done","refund"),"WITHDRAW"==i.status&&n.addClass("timeline_done","active"),i.status,i.status){case"NEW":n.remClass("order_qr","none");break;case"PENDING":case"EXCHANGE":case"WITHDRAW":case"EMERGENCY":clearInterval(i.timeInterval),n.remClass("timeline_steps","expired"),n.addClass("order_qr","none"),i.html.time_parent.setAttribute("class","order-time exchange"),i.html.action.setAttribute("class","order-action exchange"),r&&n.addClass(i.html.time_parent,"emergency");break;case"DONE":clearInterval(i.timeInterval),n.remClass("timeline_steps","expired"),n.addClass("order_qr","none"),i.refundonly?(i.html.time_parent.setAttribute("class","order-time refund"),i.html.action.setAttribute("class","order-action refund")):(i.html.time_parent.setAttribute("class","order-time done"),i.html.action.setAttribute("class","order-action done"));break;case"EXPIRED":n.addClass("timeline_steps","expired"),n.remClass("order_qr","none"),i.html.time_parent.setAttribute("class","order-time expired"),i.html.action.setAttribute("class","order-action expired")}e&&(i.html.details.innerHTML=e,a(i.html.details.getElementsByTagName("time"))),t?(i.html.details_more.innerHTML=t,n.remClass(i.html.details_more,"none"),a(i.html.details_more.getElementsByTagName("time"))):(n.addClass(i.html.details_more,"none"),i.html.details_more.innerHTML=""),r&&i.emergency.tmpl!=r&&(n.addClass(i.html.emergency,"active"),i.html.emergency.innerHTML=r,i.emergency.tmpl=r,"EXPIRED"!=i.status&&"NONE"==i.emergency.choice&&""!=i.emergency.status?i.html.action.insertBefore(i.html.emergency,i.html.action.firstElementChild):n.before("section_timeline",i.html.emergency)),r||(n.remClass(i.html.emergency,"active"),i.html.emergency.innerHTML=""),n.id("emergency_submit")&&l.init()},onResize:function(){var t=this,r=t.html.details.querySelector(".order-data-details"),i=t.html.details.querySelector(".order-data-destination"),d=t.html.details_more.querySelector(".order-data-destination");if(n.hasClass(t.html.action,"new")||n.hasClass(t.html.action,"expired")){let e=r.offsetHeight;var a,r=t.html.head_inner.offsetHeight;i&&700<document.documentElement.clientWidth?(85<(a=i.offsetHeight)||240<e)&&e+a-30>r+10?(n.remClass(t.html.head_info.parentNode,"flex-start"),t.html.details_more.appendChild(i),n.remClass(t.html.details_more,"none")):e>r+10?n.addClass(t.html.head_info.parentNode,"flex-start"):n.remClass(t.html.head_info.parentNode,"flex-start"):d&&((a=d.offsetHeight)<=55&&e<=240||e+a-30<=r+10?(t.html.details.appendChild(d),t.html.details_more.childElementCount||n.addClass(t.html.details_more,"none"),e=t.html.details.offsetHeight,e<=r+10&&n.remClass(t.html.head_info.parentNode,"flex-start")):document.documentElement.clientWidth<=700&&(t.html.details.appendChild(d),t.html.details_more.childElementCount||n.addClass(t.html.details_more,"none"),n.remClass(t.html.head_info.parentNode,"flex-start")))}else i&&document.documentElement.clientWidth<=430?i&&n.hasClass(t.html.details_more,"none")&&(t.html.details_more.appendChild(i),n.remClass(t.html.details_more,"none")):d&&430<document.documentElement.clientWidth&&(t.html.details.appendChild(d),t.html.details_more.childElementCount||n.addClass(t.html.details_more,"none"))}},l={section:void 0,submit:void 0,submitWrap:void 0,refundAddr:void 0,refundTag:void 0,refundAddrErr:void 0,refundTagErr:void 0,init:function(){let r=this;r.section=n.id("section_emergency"),r.submitWrap=n.id("emergency_submit_section"),r.submit=n.id("emergency_submit"),r.refundAddr=n.id("refund_address"),r.refundTag=n.id("refund_tag"),r.refundAddrErr=n.id("refund_address_error"),r.refundTagErr=n.id("refund_tag_error");let t=UI.radio("order_refund");function i(){if(n.remClass(r.refundAddr,"error"),t.value){n.addClass(r.submit,"loading");let e={id:o.id,choice:t.value,template:!0};"REFUND"==t.value&&(e.address=r.refundAddr.value,r.refundTag&&r.refundTag.value&&(e.tag=r.refundTag.value)),APP.api("orderSetEmergency",e).then(function(e){n.remClass(r.submit,"loading"),o.getDetails()}).catch(function(e){switch(n.remClass(r.submit,"loading"),e.code){case 302:case 303:r.refundTag.focus(),n.addClass(r.refundTag,"error"),r.refundTagErr.innerHTML=e.msg;break;case 301:case 304:default:r.refundAddr.focus(),n.addClass(r.refundAddr,"error"),r.refundAddrErr.innerHTML=e.msg,n.remClass(r.refundTag,"error")}})}}t.change(function(){n.remClass(r.refundAddr,"error"),n.togClass("refund_address_outer","hidden","REFUND"!=t.value),n.togClass("refund_tag_outer","hidden","REFUND"!=t.value),r.submitWrap.setAttribute("data-choice",t.value),n.addClass(r.submitWrap,"active"),setTimeout(function(){n.addClass(r.submitWrap,"visible-overflow")},500)}),0<t.inputs.length&&t.inputs[0].click(),n.bind(r.submit,"click",function(){i()}),n.bind(r.refundAddr,"focus",function(){n.remClass(r.refundAddr,"error")}),n.bind(r.refundTag,"focus",function(){n.remClass(r.refundTag,"error")}),n.bind(r.refundAddr,"keydown",function(e){13==e.keyCode&&e.preventDefault()}),n.bind(r.refundAddr,"keyup",function(e){13==e.keyCode&&(e.preventDefault(),i())}),n.bind(r.refundAddr,"input",function(e){clearTimeout(d.keyupWallet),n.remClass(this,"error"),r.resizeRefundField(),this.value&&r.validateRefundAddress()}),n.bind(r.refundAddr,"blur",function(){n.remClass(this,"error"),clearTimeout(d.keyupWallet),this.value&&r.validateRefundAddress()}),n.bind(r.refundTag,"keydown",function(e){13==e.keyCode&&e.preventDefault()}),n.bind(r.refundTag,"keyup",function(e){13==e.keyCode&&(e.preventDefault(),i())}),n.bind(r.refundTag,"input",function(){clearTimeout(d.keyupWallet),n.remClass(this,"error"),this.value&&r.validateRefundAddress()}),n.bind(r.refundTag,"blur",function(){n.remClass(this,"error"),clearTimeout(d.keyupWallet),this.value&&r.validateRefundAddress()}),n.on(r.section,"click",".scanqr",function(e){(e=e||event).preventDefault();let t=this.closest(".dinput").querySelector(".dinput-field");n.remClass(t,"error"),UI.qrscan({scan:function(e){e=e.match(/(?:\w+:)?(\w+)(?:\?.*)?/i);t.value=e[1],t.blur(),this.close()}})}),n.on(r.section,"click",".close",function(e){(e=e||event).preventDefault(),clearTimeout(d.keyupWallet);let t=this.closest(".dinput").querySelector(".dinput-field");t.value="",t.focus(),r.resizeRefundField()}),window.addEventListener("resize",function(){r.resizeRefundField()})},resizeRefundField:function(){this.refundAddr.style.height="0";let e=getComputedStyle(this.refundAddr,null);var t=parseFloat(e.getPropertyValue("padding-top")),r=(parseFloat(e.getPropertyValue("padding-bottom")),parseFloat(e.getPropertyValue("border-top-width")));parseFloat(e.getPropertyValue("border-bottom-width"));this.refundAddr.style.height=this.refundAddr.scrollHeight+(t-r)+"px"},validateRefundAddress:function(){var t=this;t.refundAddr&&(d.keyupWallet=setTimeout(function(){d.keyupWallet=-1;let e={currency:t.refundAddr.getAttribute("data-ccy"),address:t.refundAddr.value};t.refundTag&&t.refundTag.value&&(e.tag=t.refundTag.value),APP.api("orderAddressInfo",e).then(function(e){}).catch(function(e){switch(e.code){case 302:case 303:t.refundTag.focus(),n.addClass(t.refundTag,"error"),t.refundTagErr.innerHTML=e.msg;break;case 301:case 304:default:t.refundAddr.focus(),n.addClass(t.refundAddr,"error"),t.refundAddrErr.innerHTML=e.msg,n.remClass(t.refundTag,"error")}})},300))}};window.InitOrder=function(e){o.init(e),n.id("emergency_submit")&&l.init();let t=new APP.WSClient("wss://fixedfloat.com/ws");t.init(function(){d.wsTry=!0,this.subscribe({channel:"orderChanges",id:o.id})}),t.message("subscribed",function(e){d.wsReady=!0,o.update(e)}),t.message("orderChanges",function(e){d.wsReady=!0,o.update(e)}),t.error(function(e){d.wsTry=!1,d.wsReady=!1});let r=!1;setInterval(function(){t.isProblem&&!r&&(r=!0,console.log("WS problem"),APP.api("orderStatus",{id:o.id}).then(function(e){o.update(e.data),r=!1}).catch(function(e){r=!1}))},3e4),delete window.InitOrder}}();